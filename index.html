<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Coin ëª¨ì˜íˆ¬ì</title>
    <script src="https://s3.tradingview.com/tv.js"></script> 
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> 
    
    <style>

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #e0e0e0;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            background-color: #1a1a1a;
            color: white;
            padding: 15px 15px 10px 15px;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            flex-shrink: 0; 
            
            position: sticky; /* í—¤ë” ê³ ì • */
            top: 0;
            z-index: 20;
        }
        .header-title {
            font-size: 1.4em;
            color: #ffd700;
        }
        
        /* â­ï¸ STICKY ELEMENT 1: ê²€ìƒ‰ì°½ ì˜ì—­ â­ï¸ */
        .explore-search-wrapper {
            padding: 10px 15px; 
            flex-shrink: 0; 
            background-color: #1a1a1a; 
            border-bottom: 1px solid #333;
            
            position: sticky; 
            top: 60px; /* í—¤ë” ì•„ë˜ì— ê³ ì • */
            z-index: 10;
        }


        .screens-wrapper {
            flex-grow: 1;
            overflow: hidden; 
            position: relative;
        }
        .app-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
            background-color: #1a1a1a;
        }


        #explore-screen .explore-content {
            flex-grow: 1; 
            display: flex; 
            flex-direction: column;
            overflow: visible; 
            background-color: #1a1a1a;
        }
        
        
        #explore-screen .left-panel {
            width: 100%;
            flex-shrink: 0; 
            padding-bottom: 5px;
            border-bottom: 5px solid #1a1a1a;
        }
        
        
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 60px;
            background-color: #242424;
            border-top: 1px solid #333;
            flex-shrink: 0; 
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: #888;
            cursor: pointer;
            padding: 5px 0;
            transition: color 0.2s;
            font-size: 0.7em;
            font-weight: bold;
        }
        .nav-item.active {
            color: #007bff;
        }
        .nav-item .material-icons {
            font-size: 24px;
            margin-bottom: 2px;
        }
        
        .chart-wrapper { padding: 5px; min-height: 250px; }
        #chart-container { height: 250px; min-height: 250px; border-radius: 4px; max-height: 280px; }
        .order-area { padding: 10px 15px; } 
        
        /* â­ï¸ STICKY ELEMENT 2: ì£¼ë¬¸ íƒ­ ì˜ì—­ â­ï¸ */
        .order-tabs { 
            display: flex; 
            border-bottom: 1px solid #444; 
            margin-bottom: 0; 
            border-top: 5px solid #1a1a1a; 
            padding-top: 10px;

            position: sticky;
            top: 110px; /* ê²€ìƒ‰ì°½ ì˜ì—­ ì•„ë˜ì— ê³ ì • (ì•½ 60px + 50px) */
            z-index: 9;
            background-color: #242424; 
        }
        
        .order-tab { flex-grow: 1; text-align: center; padding: 10px 20px; cursor: pointer; font-weight: bold; color: #999; border: 1px solid #333; border-bottom: none; margin-right: -1px; background-color: #333; }
        .order-tab.active { color: #e0e0e0; background-color: #242424; border-top: 3px solid #007bff; border-bottom: 1px solid #242424; padding-top: 8px; }
        
        /* â­ï¸ STICKY ELEMENT 3: ì½”ì¸ ëª©ë¡ í—¤ë” â­ï¸ */
        .market-header { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 15px; 
            font-weight: bold; 
            font-size: 0.9em; 
            color: #999; 
            border-bottom: 1px solid #333; 
            
            position: sticky;
            top: 155px; /* ì£¼ë¬¸ íƒ­ ì˜ì—­ ì•„ë˜ì— ê³ ì • (ì•½ 110px + 45px) */
            z-index: 8;
            background-color: #242424; 
        }
        
        .coin-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #333; cursor: pointer; transition: background-color 0.1s; }
        
        /* coin-list-containerì— ë°°ê²½ìƒ‰ ì ìš© */
        #coin-list-container {
            background-color: #242424; 
        }

        .blue { color: #1e88e5; } 
        .red { color: #f0534c; } 
        .zero { color: #999; } 

        .order-input-group { margin-bottom: 10px; display: flex; align-items: center; }
        .order-input-group label { width: 70px; font-size: 0.9em; color: #999; flex-shrink: 0; }
        .order-input-group input { flex-grow: 1; padding: 8px; border: 1px solid #444; border-radius: 4px; text-align: right; background-color: #333; color: #e0e0e0; }

        .action-button { width: 100%; padding: 15px 0; margin-top: 10px; font-size: 1.1em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; color: white; }
        #buy-execute-button { background-color: #4CAF50; }
        #sell-execute-button { background-color: #f0534c; }

        .keypad-key { /* í¼ì„¼íŠ¸ ë²„íŠ¼ì— ì¬ì‚¬ìš© */
            background-color: #444; 
            color: white;
            font-size: 1.0em;
            font-weight: bold;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.1s;
            user-select: none;
            border: none;
        }
        .keypad-key:active { background-color: #555; }
        .keypad-percentage { color: #007bff; }


        .ranking-section { margin-top: 20px; padding: 15px; border-top: 1px solid #333; background-color: #242424; }
        .ranking-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dotted #444; font-size: 0.95em; }
        .ranking-item .rank { width: 40px; font-weight: bold; color: #ffd700; }
        .ranking-item .asset { font-weight: bold; }
        .my-rank { background-color: #333; padding: 10px; margin-top: 10px; border-radius: 4px; text-align: center; font-weight: bold; color: #007bff; }


        .admin-section input { width: 100%; padding: 10px; margin-bottom: 10px; background-color: #333; color: #e0e0e0; border: 1px solid #444; border-radius: 4px; }
        .admin-section button { background-color: #007bff; }
        

        #settings-screen input[type="password"] {
            width: 100%; 
            padding: 10px; 
            margin-bottom: 10px; 
            background-color: #1a1a1a; 
            color: #e0e0e0; 
            border: 1px solid #444; 
            border-radius: 4px; 
            box-sizing: border-box;
        }
        
    </style>
</head>
<body>

    <div class="screens-wrapper">
        
        <div id="summary-screen" class="app-screen">
            <div class="header" style="border-bottom: none;">
                <span class="header-title" style="color: white; font-size: 1.2em;">ìì‚°</span>
            </div>
            <div style="padding: 15px; flex-shrink: 0;">
                <h1 id="summary-total-asset" style="font-size: 2.5em; margin: 5px 0 0 0;">KRW 5,000,000</h1>
                <p id="summary-change-rate" style="color: #f0534c; font-weight: bold; margin: 0 0 15px 0;">+0.00% (+0 ì›)</p>
                <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #999;">
                    <span>íˆ¬ìê¸ˆ: <span id="summary-invested">KRW 0</span></span>
                    <span>í˜„ê¸ˆ(KRW): <span id="summary-cash">KRW 5,000,000</span></span>
                </div>
            </div>
            
            <div style="flex-grow: 1; overflow-y: auto; background-color: #1a1a1a;">
                
                <div class="ranking-section">
                    <h3 style="margin-top: 0; color: #ffd700;">ğŸ’° ìì‚° ë­í‚¹ (ìƒìœ„ 50)</h3>
                    <div id="ranking-list">
                        
                    </div>
                    <div id="my-rank-display" class="my-rank" style="display: none;">
                        
                    </div>
                </div>

                <h3 style="padding: 10px 15px 5px 15px; margin: 0; border-top: 1px solid #333; background-color: #1a1a1a;">ë³´ìœ  ì½”ì¸</h3>
                <div id="summary-holdings-list">
                    <div class="coin-item" style="border-color: #444; padding: 15px; font-size: 0.9em;">ë³´ìœ  ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <div id="explore-screen" class="app-screen" style="display: none;">
            <div class="header">
                <span class="header-title" style="color: white; font-size: 1.2em;">íƒìƒ‰</span>
            </div>
            
            <div class="explore-search-wrapper">
                <input type="text" id="coin-search-input" placeholder="ì¢…ëª© ë˜ëŠ” ì½”ì¸ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." style="width: 100%; padding: 10px; border: 1px solid #444; border-radius: 8px; background-color: #333; color: #e0e0e0; box-sizing: border-box;">
            </div>
            
            <div class="order-tabs">
                <div class="order-tab active" data-tab="buy">ë§¤ìˆ˜</div>
                <div class="order-tab" data-tab="sell">ë§¤ë„</div>
                <div class="order-tab" data-tab="hold">ë³´ìœ  ì½”ì¸</div>
            </div>

            <div class="market-header">
                <div>í•œê¸€ëª…/ì½”ë“œ</div>
                <div>í˜„ì¬ê°€</div>
                <div>ì „ì¼ëŒ€ë¹„</div>
            </div>

            <div class="explore-content">
                <div class="left-panel"> <div class="chart-wrapper">
                        <h2 id="main-title" style="margin-top: 0; font-size: 1.1em; padding: 0 5px;">ğŸ“ˆ [Fake Coin] ë¹„íŠ¸ì½”ì¸/KRW</h2>
                        <div id="chart-container"></div>
                    </div>

                    <div class="order-area">
                        <div id="buy-content" class="order-content">
                            <div class="order-input-group">
                                <label>ì£¼ë¬¸ê°€ëŠ¥</label>
                                <input type="text" id="buy-available-asset" value="0 KRW" readonly>
                            </div>
                            <div class="order-input-group">
                                <label>ë§¤ìˆ˜ê°€ê²©</label>
                                <input type="number" id="buy-price-input" value="0" min="1">
                                <span style="margin-left: 5px;">KRW</span>
                            </div>
                            
                            <div class="order-input-group">
                                <label>ìˆ˜ëŸ‰</label>
                                <input type="number" id="buy-amount-input" value="0" min="0" step="0.00000001">
                                <span style="margin-left: 5px;" id="buy-unit-display">BTC</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <button class="keypad-key keypad-percentage" data-value="25%" data-type="buy" style="width: 24%; padding: 8px;">25%</button>
                                <button class="keypad-key keypad-percentage" data-value="50%" data-type="buy" style="width: 24%; padding: 8px;">50%</button>
                                <button class="keypad-key keypad-percentage" data-value="75%" data-type="buy" style="width: 24%; padding: 8px;">75%</button>
                                <button class="keypad-key keypad-percentage" data-value="100%" data-type="buy" style="width: 24%; padding: 8px;">100%</button>
                            </div>
                            
                            <button class="action-button" id="buy-execute-button" style="background-color: #4CAF50;">Buy (ë§¤ìˆ˜)</button>
                        </div>
                        
                        <div id="sell-content" class="order-content" style="display: none;">
                            <div class="order-input-group">
                                <label>ë³´ìœ ìˆ˜ëŸ‰</label>
                                <input type="text" id="sell-holding-amount" value="0 BTC" readonly>
                            </div>
                            <div class="order-input-group">
                                <label>ë§¤ë„ê°€ê²©</label>
                                <input type="number" id="sell-price-input" value="0" min="1">
                                <span style="margin-left: 5px;">KRW</span>
                            </div>
                            
                            <div class="order-input-group">
                                <label>ìˆ˜ëŸ‰</label>
                                <input type="number" id="sell-amount-input" value="0" min="0" step="0.00000001">
                                <span style="margin-left: 5px;" id="sell-unit-display">BTC</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <button class="keypad-key keypad-percentage" data-value="25%" data-type="sell" style="width: 24%; padding: 8px;">25%</button>
                                <button class="keypad-key keypad-percentage" data-value="50%" data-type="sell" style="width: 24%; padding: 8px;">50%</button>
                                <button class="keypad-key keypad-percentage" data-value="75%" data-type="sell" style="width: 24%; padding: 8px;">75%</button>
                                <button class="keypad-key keypad-percentage" data-value="100%" data-type="sell" style="width: 24%; padding: 8px;">100%</button>
                            </div>

                            <button class="action-button" id="sell-execute-button" style="background-color: #f0534c;">Sell (ë§¤ë„)</button>
                        </div>

                        <div id="hold-content" class="order-content" style="display: none;">
                            <p>í˜„ì¬ ë³´ìœ  ì½”ì¸: <span id="holding-coin-name">BTC</span></p>
                            <p>ìˆ˜ëŸ‰: <span id="holding-amount">0.00000000</span> <span id="holding-code">BTC</span></p>
                            <p>í‰ê°€ ê¸ˆì•¡: <span id="holding-valuation">0 ì›</span></p>
                        </div>

                        <p style="font-size: 0.8em; margin-top: 20px; color: #999;">
                            ë°ì´í„° ì¶œì²˜: Bithumb API | ìµœì¢… ì—…ë°ì´íŠ¸: <span id="last-updated-time"></span>
                        </p>
                    </div>
                </div> <div id="coin-list-container">
                </div>
            </div>
        </div>
        
        <div id="reward-screen" class="app-screen" style="display: none;">
            <div class="header" style="border-bottom: none;">
                <span class="header-title" style="color: white; font-size: 1.2em;">ì ‘ì†ë³´ìƒ</span>
            </div>
            
            <div class="content-wrapper">
                <h3 style="margin-top: 0; color: #ffd700; font-size: 1.5em;">ğŸ‰ ì¼ì¼ ì ‘ì† ë³´ìƒ ğŸ‰</h3>
                <p style="font-size: 1.1em; color: #e0e0e0; margin-bottom: 50px;">
                    í•˜ë£¨ í•œ ë²ˆ 1ì²œ 5ë°±ë§Œ KRW ë¥¼ë°›ìœ¼ì„¸ìš”!
                </p>

                <button id="claim-reward-button" class="order-button" style="background-color: #007bff;">ë³´ìƒ ìˆ˜ë ¹</button>
                
                <p style="text-align: center; color: #999; margin-top: 20px;">
                    ë‹¤ìŒ ë³´ìƒ ìˆ˜ë ¹ ê°€ëŠ¥ê¹Œì§€:<br>
                    <span id="reward-timer-display" style="font-weight: bold; color: #00ff00; font-size: 1.2em;">24ì‹œê°„ 00ë¶„ 00ì´ˆ</span>
                </p>
            </div>
        </div>

        <div id="settings-screen" class="app-screen" style="display: none;">
            <div class="header" style="border-bottom: none;">
                <span class="header-title" style="color: white; font-size: 1.2em;">ì„¤ì •</span>
            </div>
            <div style="padding: 15px;">
                <h3 style="margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #333;">ê³„ì • ì •ë³´</h3>
                <p id="user-info">ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ</p>
                <button id="logout-button-settings" class="order-button" style="background-color: #f0534c; margin-top: 20px;">ë¡œê·¸ì•„ì›ƒ</button>
                
                <h3 style="padding-top: 30px; padding-bottom: 10px; border-bottom: 1px solid #333; color: #f0534c;">âš ï¸ ê³„ì • ì‚­ì œ</h3>
                <button id="withdrawal-button" class="order-button" style="background-color: #888; margin-top: 10px;">íšŒì›íƒˆí‡´</button>

                <div id="withdrawal-confirm-area" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #f0534c; border-radius: 4px; background-color: #333;">
                    <p style="margin-top: 0; font-weight: bold; color: #f0534c;">âš ï¸ ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <p style="font-size: 0.9em;">(ëª¨ë“  ìì‚° ë° ê¸°ë¡ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤)</p>
                    <input type="password" id="withdrawal-password-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" >
                    <button id="confirm-withdrawal-button" class="order-button" style="background-color: #f0534c; margin-top: 0;">íƒˆí‡´ í™•ì¸</button>
                    <button id="cancel-withdrawal-button" class="order-button" style="background-color: #555;">ì·¨ì†Œ</button>
                </div>
                
                <div id="admin-menu-section" style="display: none;">
                    <h3 style="padding-top: 20px; padding-bottom: 10px; border-bottom: 1px solid #333; color: #ffd700;">â­ï¸ ì–´ë“œë¯¼ ê´€ë¦¬ â­ï¸</h3>
                    <div class="admin-section">
                        <h4>ìœ ì € ìì‚° ê°•ì œ ì¶”ê°€</h4>
                        <input type="text" id="admin-target-user" placeholder="ìœ ì € ID (ì˜ˆ: testuser)">
                        <input type="number" id="admin-asset-amount" placeholder="ì¶”ê°€í•  ê¸ˆì•¡ (KRW)">
                        <button class="order-button" id="admin-add-asset-button" style="background-color: #4CAF50;">ìì‚° ì¶”ê°€ ì ìš©</button>
                    </div>
                </div>
                
                <h3 style="padding-top: 20px; padding-bottom: 10px; border-bottom: 1px solid #333;">ê¸°íƒ€</h3>
                <p>ì•± ë²„ì „: 1.0.4 (ì›¹ ì•±)</p>
                <p>Admin | 3119</p>
                <p>ëª¨ì˜ì½”ì¸íˆ¬ì ì—°ìŠµìš©</p>
            </div>
        </div>

    </div>
    
    <div class="bottom-nav">
        <div class="nav-item active" data-nav="summary">
            <i class="material-icons">account_balance_wallet</i>
            <span>ìì‚°</span>
        </div>
        <div class="nav-item" data-nav="explore">
            <i class="material-icons">search</i>
            <span>íƒìƒ‰</span>
        </div>
        <div class="nav-item" data-nav="reward">
            <i class="material-icons">card_giftcard</i>
            <span>ì ‘ì†ë³´ìƒ</span>
        </div>
        <div class="nav-item" data-nav="settings">
            <i class="material-icons">settings</i>
            <span>ì„¤ì •</span>
        </div>
    </div>

    <script>
        const LOGIN_PAGE = 'login.html';
        
        let currentActiveCoin = 'BTC'; 
        let currentCoinsData = {}; 
        let totalKrwAsset = 0; 
        let holdingCoins = {}; 
        let lastRewardTime = 0; 
        let currentUsername = sessionStorage.getItem('currentUser');
        let currentAdminState = false; 
        const ALL_COINS_API_URL = 'https://api.bithumb.com/public/ticker/ALL_KRW';
        const refreshInterval = 5000; 
        const REWARD_AMOUNT = 15000000; 
        const REWARD_COOLDOWN = 3600; 
        const ADMIN_ID = 'Admin1214';
        const ADMIN_PW = ' ';

        
        const navItems = document.querySelectorAll('.nav-item');
        const screens = document.querySelectorAll('.app-screen');
        const mainTitleElement = document.getElementById('main-title');
        const coinListContainer = document.getElementById('coin-list-container');
        const lastUpdatedTimeElement = document.getElementById('last-updated-time');
        const orderTabs = document.querySelectorAll('.order-tab');
        const logoutButtonSettings = document.getElementById('logout-button-settings'); 
        const buyAvailableAssetElement = document.getElementById('buy-available-asset');
        const buyPriceInput = document.getElementById('buy-price-input');
        const sellPriceInput = document.getElementById('sell-price-input');
        const sellHoldingAmountElement = document.getElementById('sell-holding-amount');
        const holdingAmountElement = document.getElementById('holding-amount');
        const holdingValuationElement = document.getElementById('holding-valuation');
        const userInfoElement = document.getElementById('user-info');
        const summaryTotalAsset = document.getElementById('summary-total-asset');
        const summaryInvested = document.getElementById('summary-invested');
        const summaryCash = document.getElementById('summary-cash');
        const summaryHoldingsList = document.getElementById('summary-holdings-list');
        const rankingListElement = document.getElementById('ranking-list');
        const myRankDisplayElement = document.getElementById('my-rank-display');
        const claimRewardButton = document.getElementById('claim-reward-button');
        const rewardTimerDisplay = document.getElementById('reward-timer-display');
        const adminMenuSection = document.getElementById('admin-menu-section');
        const adminTargetUser = document.getElementById('admin-target-user');
        const adminAssetAmount = document.getElementById('admin-asset-amount');
        const adminAddAssetButton = document.getElementById('admin-add-asset-button');
        const coinSearchInput = document.getElementById('coin-search-input');

        // â­ï¸ [ìˆ˜ì •] í‚¤íŒ¨ë“œ ê´€ë ¨ ë³€ìˆ˜ ì œê±° ë° ì‹¤í–‰ ë²„íŠ¼/ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ ë³€ìˆ˜ ì¶”ê°€
        const buyExecuteButton = document.getElementById('buy-execute-button');
        const sellExecuteButton = document.getElementById('sell-execute-button');
        const buyAmountInput = document.getElementById('buy-amount-input');
        const sellAmountInput = document.getElementById('sell-amount-input');
        const percentageButtons = document.querySelectorAll('.keypad-percentage');

        
        const withdrawalButton = document.getElementById('withdrawal-button');
        const withdrawalConfirmArea = document.getElementById('withdrawal-confirm-area');
        const withdrawalPasswordInput = document.getElementById('withdrawal-password-input');
        const confirmWithdrawalButton = document.getElementById('confirm-withdrawal-button');
        const cancelWithdrawalButton = document.getElementById('cancel-withdrawal-button');


        function getUsers() {
            const users = localStorage.getItem('fakeCoinUsers');
            return users ? JSON.parse(users) : {};
        }

        function saveUserData(username = currentUsername) {
            if (!username) return;
            const users = getUsers();
            
            if (users[username]) {
                if (username === currentUsername) {
                    users[username].totalKrwAsset = totalKrwAsset;
                    users[username].holdingCoins = holdingCoins;
                    users[username].lastRewardTime = lastRewardTime;
                    users[username].isAdmin = currentAdminState;
                }
            }
            localStorage.setItem('fakeCoinUsers', JSON.stringify(users));
        }

        function loadUserData() {
            if (!currentUsername) return;
            const users = getUsers();
            const userData = users[currentUsername];

            if (userData) {
                totalKrwAsset = userData.totalKrwAsset !== undefined ? Number(userData.totalKrwAsset) : 5000000;
                holdingCoins = userData.holdingCoins ? Object.fromEntries(
                    Object.entries(userData.holdingCoins).map(([key, value]) => [key, Number(value)])
                ) : {};
                lastRewardTime = Number(userData.lastRewardTime) || 0;
                currentAdminState = userData.isAdmin || (currentUsername === ADMIN_ID);
            } else {
                totalKrwAsset = 5000000;
                holdingCoins = {};
                lastRewardTime = 0;
                currentAdminState = (currentUsername === ADMIN_ID);
            }
            
            userInfoElement.textContent = `í˜„ì¬ ì‚¬ìš©ì: ${currentUsername}ë‹˜`;
            if (currentAdminState) {
                adminMenuSection.style.display = 'block';
                userInfoElement.textContent += ' (ê´€ë¦¬ì)';
            } else {
                adminMenuSection.style.display = 'none';
            }
            
            updateAssetDisplay();
            updateRewardTimer();
        }
        
        function handleLogout() {
            saveUserData(); 
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('currentUser');
            window.location.href = LOGIN_PAGE;
        }

        function handleWithdrawalConfirmation() {
            const enteredPassword = withdrawalPasswordInput.value;
            const users = getUsers();
            const userData = users[currentUsername];
            
            if (!userData) {
                alert('í˜„ì¬ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                handleLogout();
                return;
            }

            if (enteredPassword === userData.password) {
                if (confirm('ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ì •ë§ë¡œ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {

                    delete users[currentUsername];
                    localStorage.setItem('fakeCoinUsers', JSON.stringify(users));

                    sessionStorage.removeItem('isLoggedIn');
                    sessionStorage.removeItem('currentUser');


                    alert('íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.');
                    window.location.href = LOGIN_PAGE;
                } else {

                    withdrawalPasswordInput.value = '';
                    withdrawalConfirmArea.style.display = 'none';
                    withdrawalButton.style.display = 'block'; 
                    logoutButtonSettings.style.display = 'block';
                }
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                withdrawalPasswordInput.value = '';
            }
        }


        function formatKRW(price) { return Math.floor(parseFloat(price)).toLocaleString('ko-KR') + ' ì›'; }
        
        function formatTimeRemaining(seconds) {
            const days = Math.floor(seconds / 86400);
            seconds %= 86400;
            const hours = Math.floor(seconds / 3600);
            seconds %= 3600;
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;

            if (days > 0) return `${days}ì¼ ${hours}ì‹œê°„ ${minutes}ë¶„`;
            if (hours > 0) return `${hours}ì‹œê°„ ${minutes}ë¶„ ${secs}ì´ˆ`;
            return `${minutes.toString().padStart(2, '0')}ë¶„ ${secs.toString().padStart(2, '0')}ì´ˆ`;
        }
        
        function formatCoinAmount(amount) { 
            const fixedAmount = parseFloat(amount).toFixed(8);
            return parseFloat(fixedAmount).toString(); 
        }

        function maskUsername(username) {
            if (username.length <= 4) return username;
            return username.substring(0, 2) + '**' + username.substring(username.length - 4);
        }

        function calculateTotalAsset(userData) {
            let total = userData.totalKrwAsset || 0;
            let invested = 0;
            
            Object.keys(userData.holdingCoins || {}).forEach(coinId => {
                const amount = userData.holdingCoins[coinId];
                if (amount > 0 && currentCoinsData[coinId]) {
                    const price = currentCoinsData[coinId].closing_price || 0;
                    invested += amount * price;
                }
            });
            
            return total + invested;
        }
        
        function updateRanking() {
            const allUsers = getUsers();
            const userAssets = [];
            
            Object.keys(allUsers).forEach(username => {
                if (username === ADMIN_ID) return; 

                const totalAsset = calculateTotalAsset(allUsers[username]);
                userAssets.push({ username, totalAsset });
            });

            userAssets.sort((a, b) => b.totalAsset - a.totalAsset);

            let rankingHtml = '';
            let myRank = -1;
            
            userAssets.forEach((item, index) => {
                const rank = index + 1;
                const isCurrentUser = item.username === currentUsername;
                
                if (isCurrentUser) myRank = rank;

                if (rank <= 50) {
                    const displayUsername = isCurrentUser ? item.username : maskUsername(item.username);
                    const backgroundColor = isCurrentUser ? 'style="background-color: #383838; border-radius: 4px;"' : '';

                    rankingHtml += `
                        <div class="ranking-item" ${backgroundColor}>
                            <div class="rank">${rank}</div>
                            <div class="id">${displayUsername}</div>
                            <div class="asset">${formatKRW(item.totalAsset)}</div>
                        </div>
                    `;
                }
            });

            rankingListElement.innerHTML = rankingHtml || '<p style="text-align: center; color: #999;">ë­í‚¹ì„ ë§¤ê¸¸ ìœ ì € ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';

            if (myRank > 50) {
                myRankDisplayElement.style.display = 'block';
                myRankDisplayElement.innerHTML = `**${currentUsername}**ë‹˜ì˜ í˜„ì¬ ë“±ìˆ˜: **${myRank}**ë“± (${formatKRW(calculateTotalAsset(allUsers[currentUsername]))})`;
            } else {
                myRankDisplayElement.style.display = 'none';
            }
        }


        function loadTradingViewChart(coinCode) {
            document.getElementById('chart-container').innerHTML = ''; 
            const tradingviewSymbol = `BITHUMB:${coinCode}KRW`;

            new TradingView.widget({
                "container_id": "chart-container",
                "symbol": tradingviewSymbol,
                "interval": "60",
                "timezone": "Asia/Seoul",
                "theme": "dark", 
                "style": "1", 
                "locale": "kr",
                "toolbar_bg": "#1a1a1a",
                "enable_publishing": false,
                "withdateranges": true,
                "allow_symbol_change": false,
                "hide_side_toolbar": true, 
                "details": false, 
                "studies": [ "MASimple@tv-basicstudies", "Volume@tv-basicstudies" ],
                "width": "100%", 
                "height": "100%", 
                "overrides": {
                    "paneProperties.background": "#242424",
                    "paneProperties.vertGridProperties.color": "#333333",
                    "paneProperties.horzGridProperties.color": "#333333",
                    "mainSeriesProperties.candleStyle.upColor": "#f0534c", 
                    "mainSeriesProperties.candleStyle.downColor": "#1e88e5", 
                    "mainSeriesProperties.candleStyle.borderUpColor": "#f0534c",
                    "mainSeriesProperties.candleStyle.borderDownColor": "#1e88e5",
                    "mainSeriesProperties.candleStyle.wickUpColor": "#f0534c",
                    "mainSeriesProperties.candleStyle.wickDownColor": "#1e88e5"
                }
            });
        }
        
        function updateAssetDisplay() {
            let totalInvestedValue = 0;
            let holdingHtml = '';

            Object.keys(holdingCoins).forEach(coinId => {
                const amount = holdingCoins[coinId];
                if (amount > 0 && currentCoinsData[coinId]) {
                    const price = currentCoinsData[coinId].closing_price || 0;
                    const value = amount * price;
                    totalInvestedValue += value;
                    
                    holdingHtml += `
                        <div class="coin-item" data-id="${coinId}" style="border-color: #444; padding: 15px;">
                            <div>
                                ${currentCoinsData[coinId].name}
                                <div style="font-size: 0.8em; color: #999;">${formatCoinAmount(amount)} ${coinId}</div>
                            </div>
                            <div style="font-weight: bold;">${formatKRW(value)}</div>
                        </div>
                    `;
                }
            });

            const totalAsset = totalKrwAsset + totalInvestedValue;
            summaryTotalAsset.textContent = formatKRW(totalAsset);
            summaryInvested.textContent = formatKRW(totalInvestedValue);
            summaryCash.textContent = formatKRW(totalKrwAsset);
            summaryHoldingsList.innerHTML = holdingHtml || '<div class="coin-item" style="border-color: #444; padding: 15px; font-size: 0.9em;">ë³´ìœ  ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            
            buyAvailableAssetElement.value = formatKRW(totalKrwAsset); 
            const coinHolding = holdingCoins[currentActiveCoin] || 0;
            const holdingDisplay = formatCoinAmount(coinHolding);
            sellHoldingAmountElement.value = holdingDisplay + ' ' + currentActiveCoin;
            holdingAmountElement.textContent = holdingDisplay;
            document.getElementById('holding-code').textContent = currentActiveCoin;
            document.getElementById('holding-coin-name').textContent = currentCoinsData[currentActiveCoin]?.name || currentActiveCoin;
            const currentPrice = currentCoinsData[currentActiveCoin]?.closing_price || 0;
            const valuation = currentPrice * coinHolding;
            holdingValuationElement.textContent = formatKRW(valuation);

            // â­ï¸ [ì¶”ê°€] ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œì˜ ë‹¨ìœ„ ì—…ë°ì´íŠ¸ â­ï¸
            document.getElementById('buy-unit-display').textContent = currentActiveCoin;
            document.getElementById('sell-unit-display').textContent = currentActiveCoin;

            updateRanking();
        }

        function updateRewardTimer() {
            const now = Math.floor(Date.now() / 1000);
            const timeElapsed = now - lastRewardTime;
            const timeLeft = REWARD_COOLDOWN - timeElapsed;

            if (timeLeft <= 0) {
                claimRewardButton.disabled = false;
                claimRewardButton.textContent = `ë³´ìƒ ìˆ˜ë ¹ (${formatKRW(REWARD_AMOUNT)})`;
                rewardTimerDisplay.textContent = 'ìˆ˜ë ¹ ê°€ëŠ¥';
                rewardTimerDisplay.style.color = '#00ff00';
            } else {
                claimRewardButton.disabled = true;
                claimRewardButton.textContent = `ë‹¤ìŒ ë³´ìƒê¹Œì§€`;
                rewardTimerDisplay.textContent = formatTimeRemaining(timeLeft);
                rewardTimerDisplay.style.color = '#ffff00';
            }
        }

        function handleCoinClick(event) {
            const item = event.currentTarget;
            const coinId = item.dataset.id;
            
            if (coinId && currentCoinsData[coinId] && coinId !== currentActiveCoin) {
                currentActiveCoin = coinId;
                
                loadTradingViewChart(coinId);
                
                mainTitleElement.textContent = `ğŸ“ˆ [Fake Coin] ${currentCoinsData[coinId].name} (${coinId}/KRW)`;
                
                if (document.querySelector('.nav-item.active').dataset.nav !== 'explore') {
                    switchScreen('explore');
                }

                // âŒ í‚¤íŒ¨ë“œ ê´€ë ¨ í˜¸ì¶œ ì œê±° 
                buyAmountInput.value = '0';
                sellAmountInput.value = '0';
                
                const activeTab = document.querySelector('.order-tab.active')?.dataset.tab || 'buy';
                switchOrderTab(activeTab); 
                updateAssetDisplay(); 
            }
        }

        // âŒ closeAllKeypads í•¨ìˆ˜ ì œê±° 

        function switchOrderTab(tabName) {
            document.querySelectorAll('.order-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.order-content').forEach(content => content.style.display = 'none');
            
            const targetTab = document.querySelector(`.order-tab[data-tab="${tabName}"]`);
            const targetContent = document.getElementById(`${tabName}-content`);
            
            if (targetTab) targetTab.classList.add('active');
            if (targetContent) targetContent.style.display = 'block';

            // âŒ í‚¤íŒ¨ë“œ ê´€ë ¨ í˜¸ì¶œ ì œê±° 
            
            if (tabName === 'buy' || tabName === 'sell') {
                const coinCode = currentActiveCoin;
                
                if (currentCoinsData[coinCode]) {
                    const price = currentCoinsData[coinCode].closing_price || 0;
                    document.getElementById('buy-price-input').value = Math.floor(price);
                    document.getElementById('sell-price-input').value = Math.floor(price);
                }
            }
            updateAssetDisplay();
        }

        function switchScreen(screenName) {
            screens.forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(`${screenName}-screen`).style.display = 'flex'; 

            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-item[data-nav="${screenName}"]`).classList.add('active');
            
            if (screenName === 'summary' || screenName === 'explore') {
                updateAssetDisplay();
                if (screenName === 'explore') {
                    loadTradingViewChart(currentActiveCoin);
                }
            }

            if (screenName === 'settings') {
                withdrawalConfirmArea.style.display = 'none';
                withdrawalPasswordInput.value = '';
                withdrawalButton.style.display = 'block'; 
                logoutButtonSettings.style.display = 'block';
            }
        }


        // âŒ toggleKeypad í•¨ìˆ˜ ì œê±°
        // âŒ updateKeypadDisplay í•¨ìˆ˜ ì œê±°
        // âŒ handleKeypadInput í•¨ìˆ˜ ì œê±°


        function executeBuy() {
            const price = parseFloat(buyPriceInput.value.replace(/,/g, ''));
            const amount = parseFloat(buyAmountInput.value); 
            const cost = price * amount;
            
            if (isNaN(price) || price <= 0 || isNaN(amount) || amount <= 0) { return alert('ë§¤ìˆ˜ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ê³ , ê°€ê²©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); }
            if (cost > totalKrwAsset) { return alert(`KRW ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${formatKRW(cost)})`); }

            totalKrwAsset -= cost;
            holdingCoins[currentActiveCoin] = (holdingCoins[currentActiveCoin] || 0) + amount;
            
            saveUserData(); 
            alert(`${currentActiveCoin} ${formatCoinAmount(amount)}ê°œë¥¼ ${formatKRW(cost)}ì— ë§¤ìˆ˜í–ˆìŠµë‹ˆë‹¤.`);
            
            buyAmountInput.value = '0';
            updateAssetDisplay();
        }

        function executeSell() {
            const price = parseFloat(sellPriceInput.value.replace(/,/g, ''));
            const amount = parseFloat(sellAmountInput.value); 
            const revenue = price * amount;
            const coinHolding = holdingCoins[currentActiveCoin] || 0;
            
            if (isNaN(price) || price <= 0 || isNaN(amount) || amount <= 0) { return alert('ë§¤ë„ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ê³ , ê°€ê²©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); }
            if (amount > coinHolding) { return alert(`${currentActiveCoin} ë³´ìœ  ìˆ˜ëŸ‰(${formatCoinAmount(coinHolding)})ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.`); }

            totalKrwAsset += revenue;
            holdingCoins[currentActiveCoin] = coinHolding - amount;
            
            if (Math.abs(holdingCoins[currentActiveCoin]) < 1e-8) {
                holdingCoins[currentActiveCoin] = 0;
            }

            saveUserData(); 
            alert(`${currentActiveCoin} ${formatCoinAmount(amount)}ê°œë¥¼ ${formatKRW(revenue)}ì— ë§¤ë„í–ˆìŠµë‹ˆë‹¤.`);

            sellAmountInput.value = '0';
            updateAssetDisplay();
        }

        function handleReward() {
            const now = Math.floor(Date.now() / 1000);
            if (now - lastRewardTime >= REWARD_COOLDOWN) {
                totalKrwAsset += REWARD_AMOUNT;
                lastRewardTime = now;
                saveUserData(); 
                updateAssetDisplay();
                updateRewardTimer();
                alert(`ì ‘ì† ë³´ìƒ ${formatKRW(REWARD_AMOUNT)}ì„ ë°›ì•˜ìŠµë‹ˆë‹¤! ì´ í˜„ê¸ˆ: ${formatKRW(totalKrwAsset)}`);
            } else {
                const timeLeft = REWARD_COOLDOWN - (now - lastRewardTime);
                alert(`ì•„ì§ ë³´ìƒì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ${formatTimeRemaining(timeLeft)} í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.`);
            }
        }
        
        function handleAdminAddAsset() {
            if (!currentAdminState) return alert('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');

            const targetUser = adminTargetUser.value.trim();
            const amount = parseFloat(adminAssetAmount.value);

            if (!targetUser || isNaN(amount) || amount <= 0) {
                return alert('ìœ ì € IDì™€ ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }

            const users = getUsers();
            if (!users[targetUser]) {
                return alert(`ìœ ì € ID ${targetUser}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }

            const currentAsset = users[targetUser].totalKrwAsset || 0;
            users[targetUser].totalKrwAsset = currentAsset + amount;

            localStorage.setItem('fakeCoinUsers', JSON.stringify(users));
            
            if (targetUser === currentUsername) {
                totalKrwAsset = users[currentUsername].totalKrwAsset;
                updateAssetDisplay();
            } else {
                updateRanking();
            }

            alert(`ìœ ì € ${targetUser}ì—ê²Œ ${formatKRW(amount)}ì´(ê°€) ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            adminTargetUser.value = '';
            adminAssetAmount.value = '';
        }

        function filterCoinList(query) {
            const items = coinListContainer.querySelectorAll('.coin-item');
            const lowerCaseQuery = query.toLowerCase();

            items.forEach(item => {
                const coinName = item.querySelector('.coin-name').textContent.toLowerCase();
                if (coinName.includes(lowerCaseQuery) || item.dataset.id.toLowerCase().includes(lowerCaseQuery)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        async function fetchAndUpdatePrices() {
            try {
                const response = await fetch(ALL_COINS_API_URL);
                const apiResponse = await response.json();
                
                if (apiResponse.status !== '0000') throw new Error("API ì‘ë‹µ ì˜¤ë¥˜");

                const data = apiResponse.data;
                const marketData = Object.keys(data).filter(key => key !== 'date').map(key => ({
                    id: key, name: key, ...data[key],
                    changeRate: parseFloat(data[key].fluctate_rate_24H),
                    closing_price: parseFloat(data[key].closing_price)
                }));
                
                const coinList = [
                    { id: 'BTC', name: 'ë¹„íŠ¸ì½”ì¸' }, { id: 'ETH', name: 'ì´ë”ë¦¬ì›€' },
                    { id: 'XRP', name: 'ë¦¬í”Œ' }, { id: 'ADA', name: 'ì—ì´ë‹¤' },
                    { id: 'DOGE', name: 'ë„ì§€ì½”ì¸' }, { id: 'SOL', name: 'ì†”ë¼ë‚˜' },
                    { id: 'DOT', name: 'í´ì¹´ë‹·' }, { id: 'LINK', name: 'ì²´ì¸ë§í¬' },
                    { id: 'BNB', name: 'ë°”ì´ë‚¸ìŠ¤ ì½”ì¸' }, { id: 'AVAX', name: 'ì•„ë°œë€ì²´' },
                    { id: 'TRX', name: 'íŠ¸ë¡ ' }, { id: 'BCH', name: 'ë¹„íŠ¸ì½”ì¸ ìºì‹œ' },
                    { id: 'LTC', name: 'ë¼ì´íŠ¸ì½”ì¸' }, { id: 'ETC', name: 'ì´ë”ë¦¬ì›€ í´ë˜ì‹' },
                    { id: 'FLOW', name: 'í”Œë¡œìš°' }, { id: 'QTUM', name: 'í€€í…€' },
                    { id: 'EOS', name: 'ì´ì˜¤ìŠ¤' }, { id: 'CHZ', name: 'ì¹ ë¦¬ì¦ˆ' },
                    { id: 'WAXP', name: 'ì™ìŠ¤' }, { id: 'T', name: 'ì“°ë ˆìŠ¤í™€ë“œ' },
                    { id: 'GMT', name: 'ìŠ¤í…Œí”ˆ' }, { id: 'MANA', name: 'ë””ì„¼íŠ¸ëŸ´ëœë“œ' },
                    { id: 'MATIC', name: 'í´ë¦¬ê³¤' }, { id: 'ATOM', name: 'ì½”ìŠ¤ëª¨ìŠ¤' },
                    { id: 'NEAR', name: 'ë‹ˆì–´ í”„ë¡œí† ì½œ' }, { id: 'SAND', name: 'ìƒŒë“œë°•ìŠ¤' },
                    { id: 'AAVE', name: 'ì—ì´ë¸Œ' }, { id: 'AXS', name: 'ì•¡ì‹œ ì¸í”¼ë‹ˆí‹°' },
                    { id: 'SUI', name: 'ìˆ˜ì´' }, { id: 'STX', name: 'ìŠ¤íƒìŠ¤' },
                    { id: 'HBAR', name: 'í—¤ë°ë¼' }, { id: 'WEMIX', name: 'ìœ„ë¯¹ìŠ¤' },
                    { id: 'ZIL', name: 'ì§ˆë¦¬ì¹´' }, { id: 'IMX', name: 'ì´ë®¤í„°ë¸”ì—‘ìŠ¤' },
                    { id: 'ALGO', name: 'ì•Œê³ ë¦¬ëœë“œ' }, { id: 'ICX', name: 'ì•„ì´ì½˜' },
                    { id: 'SEI', name: 'ì„¸ì´' }, { id: 'APT', name: 'ì•±í† ìŠ¤' },
                    { id: '1INCH', name: 'ì›ì¸ì¹˜' }, { id: 'SSX', name: 'ì¸ì”½' },
                    { id: 'CVC', name: 'ì‹œë¹…' }, { id: 'GALA', name: 'ê°ˆë¼' },
                    { id: 'SHIB', name: 'ì‹œë°”ì´ëˆ„' }, { id: 'STORJ', name: 'ìŠ¤í† ë¦¬ì§€' },
                    { id: 'JST', name: 'ì €ìŠ¤íŠ¸' }, { id: 'ENJ', name: 'ì—”ì§„ì½”ì¸' },
                    { id: 'BAT', name: 'ë² ì´ì§ì–´í…ì…˜í† í°' }, { id: 'VET', name: 'ë¹„ì²´ì¸' },
                    { id: 'WAVES', name: 'ì›¨ì´ë¸Œ' }, { id: 'KNC', name: 'ì¹´ì´ë²„ ë„¤íŠ¸ì›Œí¬' }
                ];

                marketData.forEach(coin => {
                    const match = coinList.find(c => c.id === coin.id);
                    const koreanName = match ? match.name : coin.id;

                    currentCoinsData[coin.id] = { ...coin, name: koreanName };
                    if (holdingCoins[coin.id] === undefined) {
                        holdingCoins[coin.id] = 0.0;
                    }
                });
                
                const coinListHtml = marketData
                    .filter(coin => coinList.some(c => c.id === coin.id)) 
                    .map(coin => {
                        let colorClass = 'zero';
                        if (coin.changeRate > 0) colorClass = 'red'; 
                        else if (coin.changeRate < 0) colorClass = 'blue'; 
                        
                        const priceFormatted = formatKRW(coin.closing_price).replace(' ì›', '');
                        const changeFormatted = `${(coin.changeRate > 0 ? '+' : '')}${coin.changeRate.toFixed(2)}%`;

                        return `
                            <div class="coin-item" data-id="${coin.id}">
                                <div class="coin-name">
                                    ${currentCoinsData[coin.id].name}
                                    <div class="coin-code" style="font-size: 0.8em; color: #999;">${coin.id}/KRW</div>
                                </div>
                                <div class="current-price ${colorClass}" id="list-price-${coin.id}" style="width: 100px; text-align: right; font-weight: bold;">
                                    ${priceFormatted}
                                </div>
                                <div class="change-rate ${colorClass}" id="list-change-${coin.id}" style="width: 80px; text-align: right; font-weight: bold;">
                                    ${changeFormatted}
                                </div>
                            </div>
                        `;
                    }).join('');
                
                coinListContainer.innerHTML = coinListHtml;
                
                document.querySelectorAll('.coin-item').forEach(item => {
                    item.removeEventListener('click', handleCoinClick);
                    item.addEventListener('click', handleCoinClick);
                });
                
                mainTitleElement.textContent = `ğŸ“ˆ [Fake Coin] ${currentCoinsData[currentActiveCoin]?.name || currentActiveCoin} (${currentActiveCoin}/KRW)`;
                updateAssetDisplay(); 

                lastUpdatedTimeElement.textContent = new Date().toLocaleTimeString('ko-KR');

                filterCoinList(coinSearchInput.value);

            } catch (error) {
                console.error("ì‹œì„¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                lastUpdatedTimeElement.textContent = "ì—…ë°ì´íŠ¸ ì‹¤íŒ¨";
            }
        }

        window.onload = () => {

            if (sessionStorage.getItem('isLoggedIn') !== 'true' || !currentUsername) {
                window.location.href = LOGIN_PAGE; 
                return;
            }


            const users = getUsers();
            if (users[ADMIN_ID] === undefined) {
                users[ADMIN_ID] = {
                    password: ADMIN_PW,
                    totalKrwAsset: 1000000000, 
                    holdingCoins: {},
                    lastRewardTime: 0,
                    isAdmin: true
                };
                localStorage.setItem('fakeCoinUsers', JSON.stringify(users));
            }

            loadUserData();
            

            // â­ï¸ [ìˆ˜ì •] ì‹¤í–‰ ë²„íŠ¼ì— ì§ì ‘ ì—°ê²° â­ï¸
            buyExecuteButton.addEventListener('click', executeBuy); 
            sellExecuteButton.addEventListener('click', executeSell); 
            
            // â­ï¸ [ì¶”ê°€] í¼ì„¼íŠ¸ ë²„íŠ¼ ë¡œì§ êµ¬í˜„ â­ï¸
            percentageButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const percentage = parseFloat(e.target.dataset.value) / 100;
                    const type = e.target.dataset.type;
                    const currentPrice = parseFloat(document.getElementById(`${type}-price-input`).value) || 0;
                    let calculatedAmount = 0;

                    if (type === 'buy') {
                        const krwToUse = totalKrwAsset * percentage;
                        if (currentPrice > 0) calculatedAmount = krwToUse / currentPrice;
                        buyAmountInput.value = calculatedAmount.toFixed(8).replace(/\.?0+$/, "");
                    } else if (type === 'sell') {
                        const coinHolding = holdingCoins[currentActiveCoin] || 0;
                        calculatedAmount = coinHolding * percentage;
                        sellAmountInput.value = calculatedAmount.toFixed(8).replace(/\.?0+$/, "");
                    }
                });
            });
            
            claimRewardButton.addEventListener('click', handleReward);
            logoutButtonSettings.addEventListener('click', handleLogout); 
            adminAddAssetButton.addEventListener('click', handleAdminAddAsset);
            coinSearchInput.addEventListener('input', (e) => filterCoinList(e.target.value));
            

            withdrawalButton.addEventListener('click', () => {
                withdrawalConfirmArea.style.display = 'block';
                withdrawalPasswordInput.focus();
                withdrawalPasswordInput.value = '';
                withdrawalButton.style.display = 'none'; 
                logoutButtonSettings.style.display = 'none';
            });
            
            cancelWithdrawalButton.addEventListener('click', () => {
                withdrawalConfirmArea.style.display = 'none';
                withdrawalPasswordInput.value = '';
                withdrawalButton.style.display = 'block'; 
                logoutButtonSettings.style.display = 'block';
            });
            
            confirmWithdrawalButton.addEventListener('click', handleWithdrawalConfirmation);
      

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    const screenName = e.currentTarget.dataset.nav;
                    switchScreen(screenName);
                });
            });

            orderTabs.forEach(tab => {
                tab.addEventListener('click', () => switchOrderTab(tab.dataset.tab));
            });

            switchScreen('summary'); 
            loadTradingViewChart(currentActiveCoin); 
            fetchAndUpdatePrices(); 
            
            setInterval(fetchAndUpdatePrices, refreshInterval);
            setInterval(updateRewardTimer, 1000); 

            window.addEventListener('beforeunload', saveUserData);
        };

    </script>
</body>
</html>
